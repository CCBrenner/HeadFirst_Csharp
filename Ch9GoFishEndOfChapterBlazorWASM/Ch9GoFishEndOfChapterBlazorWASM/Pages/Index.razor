@page "/"

<PageTitle>GoFish</PageTitle>


<div class="container">
    <br/>
    <div class="row">
        <div class="col-5">
            <div class="row">
                <label size="18">Game Status</label>
                <textarea rows="18">@gameController.GameStatus</textarea>
            </div>
            <br/>
            <div class="row">
                <label>Current Standings</label>
                <textarea rows="6">@gameController.CurrentStandings</textarea>
            </div>
        </div>
        <div class="col-1"></div>
        <div class="col-5">
            <div class="row">
                <div class="col-6">
                    <label class="w-100">Your Hand
                        <select @bind="gameController.SelectedCard" size="16" class="w-100 text-center">
                            @for (int i = 0; i < gameController.HumanPlayer.Hand.Count(); i++)
                            {
                                <option value="@i">@gameController.HumanPlayer.Hand.Skip(i).First().ToString()</option>
                            }
                        </select>
                    </label>
                </div>
                <div class="col-6">
                    <label class="w-100">Opponents to Ask
                        <select @bind="gameController.SelectedOpponent" size="16" class="w-100 text-center">
                            @for (int i = 0; i < gameController.Opponents.Count(); i++)
                            {
                                <option value="@i">@gameController.Opponents.Skip(i).First().Name</option>
                            }
                        </select>
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="w-100">
                    <br/>
                    <div class="w-100">@gameController.WhatPlayerIsAskingFor()&nbsp;</div>
                    <br/>
                    <button class="btn btn-primary w-100" @onclick="NextRound">
                        @gameController.ButtonText()
                    </button>
                </div>
            </div>
        </div>
        <div class="col-1"></div>
    </div>
</div>

@code
{
    GameController gameController = new GameController("Player 1", 4);

    public void NextRound()
    {
        Player nextRoundPlayer;
        Value nextRoundValue;

        if (gameController.HumanPlayer.Hand.Count() > 0 || gameController.gameState.Stock.Count() > 0)
        {
            nextRoundPlayer = gameController.Opponents.Skip(gameController.SelectedOpponent).First();
            nextRoundValue = gameController.HumanPlayer.Hand.Skip(gameController.SelectedCard).First().Value;
        }
        else
        {
            nextRoundPlayer = gameController.HumanPlayer;
            nextRoundValue = Value.Null;
        }

        if (gameController.ReturnSelectedCard(gameController.SelectedCard).Value != Value.Null || gameController.HumanPlayer.Hand.Count() == 0)
            gameController.NextRound(nextRoundPlayer, nextRoundValue);
    }
}
